---
# cPanel Git Deployment Configuration
# SUNDARI TOP STAR S.R.L. - Piese MaÈ™ini de Cusut
# Updated for secure and selective deployment

deployment:
  tasks:
    # Set deployment path - UPDATE THIS with your cPanel username
    - export DEPLOYPATH=/home/fovyarnx/public_html

    # Clean deployment directory (optional - be careful!)
    # - /bin/rm -rf $DEPLOYPATH/*

    # Copy essential directories and files
    - /bin/cp -r admin api assets config includes pages $DEPLOYPATH/ 2>/dev/null || true

    # Copy essential root files
    - /bin/cp index.php robots.txt sitemap.php .htaccess $DEPLOYPATH/ 2>/dev/null || true

    # Create necessary directories if they don't exist
    - /bin/mkdir -p $DEPLOYPATH/logs
    - /bin/mkdir -p $DEPLOYPATH/assets/images/products

    # Set secure permissions
    # Directories: 755 (read+execute for others)
    - /bin/find $DEPLOYPATH -type d -exec /bin/chmod 755 {} \;

    # PHP files: 644 (read-only for others)
    - /bin/find $DEPLOYPATH -name "*.php" -type f -exec /bin/chmod 644 {} \;

    # Config files: 640 (read-only for owner and group, none for others)
    - /bin/chmod 640 $DEPLOYPATH/config/config.php
    - /bin/chmod 640 $DEPLOYPATH/config/database.php

    # Static files: 644
    - /bin/find $DEPLOYPATH \( -name "*.css" -o -name "*.js" -o -name "*.txt" -o -name "*.json" \) -type f -exec /bin/chmod 644 {} \;

    # Upload directories: 755 (writeable by web server)
    - /bin/chmod 755 $DEPLOYPATH/assets/images
    - /bin/chmod 755 $DEPLOYPATH/assets/images/products
    - /bin/chmod 755 $DEPLOYPATH/logs

    # Remove any debug/development files from production
    - /bin/rm -f $DEPLOYPATH/debug_cart.php 2>/dev/null || true
    - /bin/rm -f $DEPLOYPATH/migrate_cart.php 2>/dev/null || true
    - /bin/rm -f $DEPLOYPATH/test_cart_fix.php 2>/dev/null || true
    - /bin/rm -f $DEPLOYPATH/verify_fixes.php 2>/dev/null || true
    - /bin/rm -f $DEPLOYPATH/check_errors.php 2>/dev/null || true
    - /bin/rm -f $DEPLOYPATH/cleanup_cart.php 2>/dev/null || true

    # Remove documentation files (optional)
    # - /bin/rm -f $DEPLOYPATH/*.md 2>/dev/null || true

    # Verify deployment
    - echo "Deployment completed to: $DEPLOYPATH"
    - echo "Files count: $(/bin/find $DEPLOYPATH -type f | wc -l)"
    - echo "Directories count: $(/bin/find $DEPLOYPATH -type d | wc -l)"
